{"version":3,"names":[],"mappings":"","sources":["app.js"],"sourcesContent":["let paso = 1;\r\n\r\nconst paginadorIncial = 1;\r\nconst paginadorFinal = 3;\r\n\r\nconst cita = {\r\n    id: '',\r\n    nombre: '',\r\n    fecha: '',\r\n    hora: '',\r\n    servicios: []\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', function(){\r\n    iniciarApp();\r\n\r\n});\r\n\r\n\r\nfunction iniciarApp(){\r\n\r\n    mostrarSeccion();\r\n    tabs(); //cambia entre secciones\r\n    botonesPaginador();\r\n    paginaSiguiente(); \r\n    paginaAnterior();\r\n\r\n    //API para servicios\r\n    consultarAPI();\r\n    idCliente();\r\n    nombreCliente(); //anade el nombre del cliente en el objeto cita\r\n    seleccionarFecha(); //anade la fecha de la cita en el objeto\r\n    seleccionarHora();//anade la hora de la cita en el objeto\r\n\r\n    mostrarResumen();\r\n    \r\n}\r\n\r\nfunction mostrarSeccion(){\r\n\r\n    //seleccionar la seccion visible actual\r\n    const seccionAnterior = document.querySelector('.mostrar');\r\n    if(seccionAnterior){\r\n        seccionAnterior.classList.remove('mostrar');\r\n    }\r\n\r\n    //seleccionar la seccion con el paso al que se dio click\r\n    const seccion = document.querySelector(`#paso-${paso}`);\r\n    seccion.classList.add('mostrar');\r\n\r\n\r\n    //cambiar color de tab actual\r\n    const tabAnterior = document.querySelector('.actual');\r\n    if(tabAnterior){\r\n        tabAnterior.classList.remove('actual');\r\n    }\r\n\r\n    const tabActual = document.querySelector(`[data-paso=\"${paso}\"]`);\r\n    tabActual.classList.add('actual');\r\n}\r\n\r\nfunction tabs(){\r\n    const botones = document.querySelectorAll('.tabs button');\r\n\r\n    botones.forEach(function(boton){\r\n        boton.addEventListener('click',function(e){\r\n            paso = parseInt(e.target.dataset.paso);\r\n\r\n            mostrarSeccion();\r\n            botonesPaginador();\r\n        })\r\n    });\r\n}\r\n\r\nfunction botonesPaginador(){\r\n    const paginaAnterior = document.querySelector('#anterior');\r\n    const paginaSiguiente = document.querySelector('#siguiente');\r\n\r\n    if(paso === 1){\r\n        paginaAnterior.classList.add('ocultar');\r\n        paginaSiguiente.classList.remove('ocultar');\r\n    }else if(paso === 3){\r\n        paginaAnterior.classList.remove('ocultar');\r\n        paginaSiguiente.classList.add('ocultar');\r\n        \r\n        mostrarResumen();\r\n    }else{\r\n        paginaAnterior.classList.remove('ocultar');\r\n        paginaSiguiente.classList.remove('ocultar');\r\n    }\r\n\r\n    mostrarSeccion();\r\n}\r\n\r\nfunction paginaAnterior(){\r\n    const paginaAnterior = document.querySelector('#anterior');\r\n\r\n    paginaAnterior.addEventListener('click', function(){\r\n\r\n        if(paso <= paginadorIncial) return;\r\n        paso--;\r\n        botonesPaginador();\r\n    });\r\n}\r\n\r\nfunction paginaSiguiente(){\r\n\r\n    const paginaSiguiente = document.querySelector('#siguiente');\r\n\r\n    paginaSiguiente.addEventListener('click', function(){\r\n\r\n        if(paso >= paginadorFinal) return;\r\n        paso++;\r\n        botonesPaginador();\r\n    });\r\n}\r\n\r\n\r\nasync function consultarAPI(){\r\n\r\n    try {\r\n        const url = 'http://localhost:3000/api/servicios';\r\n        const resultado = await fetch(url);\r\n        const servicios = await resultado.json();\r\n        mostrarServicios(servicios);\r\n\r\n    } catch (error) {\r\n        console.log(error);\r\n    }\r\n}\r\n\r\nfunction mostrarServicios(servicios){\r\n\r\n    servicios.forEach(function(servicio){\r\n        const {id,nombre,precio} = servicio;\r\n        \r\n        const nombreServicio = document.createElement('P');\r\n        nombreServicio.classList.add('nombre-servicio');\r\n        nombreServicio.textContent = nombre;\r\n\r\n        const precioServicio = document.createElement('P');\r\n        precioServicio.classList.add('precio-servicio');\r\n        precioServicio.textContent =`$${precio}`;\r\n\r\n        const servicioDiv = document.createElement('DIV');\r\n        servicioDiv.classList.add('servicio');\r\n        servicioDiv.dataset.idServicio = id;\r\n        servicioDiv.onclick = function(){\r\n            seleccionarServicio(servicio);\r\n        }\r\n\r\n        servicioDiv.appendChild(nombreServicio);\r\n        servicioDiv.appendChild(precioServicio);\r\n\r\n        const listadoServicios  = document.querySelector('.listado-servicios');\r\n        listadoServicios.appendChild(servicioDiv);\r\n    });\r\n}\r\n\r\n\r\nfunction seleccionarServicio(servicio){\r\n    \r\n    const {id} = servicio;\r\n    const {servicios} = cita;\r\n    \r\n    const servicioDiv = document.querySelector(`[data-id-servicio=\"${id}\"]`);\r\n    \r\n    // comprobar si el servicio ya fue agregado\r\n    if( servicios.some(agregado => agregado.id === id) ){\r\n        cita.servicios = servicios.filter(agregado => agregado.id != id);\r\n    }else{\r\n       cita.servicios = [...servicios, servicio];\r\n    }\r\n\r\n    servicioDiv.classList.toggle('seleccionado');\r\n}\r\n\r\nfunction idCliente(){\r\n    cita.id = document.querySelector('#id').value;\r\n\r\n}\r\n\r\nfunction nombreCliente(){\r\n    cita.nombre = document.querySelector('#nombre').value;\r\n\r\n}\r\n\r\nfunction seleccionarFecha(){\r\n    const inputFecha = document.querySelector('#fecha');\r\n\r\n    inputFecha.addEventListener('input', function(e){\r\n        \r\n        const dia = new Date(e.target.value).getUTCDay();\r\n\r\n        if([6,0].includes(dia)){\r\n            e.target.value = '';\r\n            mostrarAlerta('Fines de semana no permitidos','error','.formulario');\r\n        }else{\r\n            cita.fecha = e.target.value;\r\n\r\n            const alerta = document.querySelector('.alerta.error');\r\n            if(alerta){\r\n                alerta.remove();\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction seleccionarHora(){\r\n    const inputHora = document.querySelector('#hora');\r\n\r\n    inputHora.addEventListener('input',function(e){\r\n\r\n        const horaCita = e.target.value;\r\n\r\n        const hora = horaCita.split(':')[0]; //obtiene solo el valor de la hora y seprara los minutos\r\n\r\n        if(hora <10 || hora >18){\r\n            mostrarAlerta('Hora no valida, nuestro horario es de 10:00 a 18:00','error','.formulario');\r\n            e.target.value = ''; \r\n        }else{\r\n           cita.hora = horaCita;\r\n        }\r\n    });\r\n}\r\n\r\n\r\nfunction mostrarAlerta(mensaje, tipo, elemento, desaparece = true){\r\n\r\n    const alertaPrevia = document.querySelector('.alerta');\r\n    if(alertaPrevia){\r\n        alertaPrevia.remove();\r\n    }\r\n\r\n    const alerta = document.createElement('DIV');\r\n    alerta.textContent = mensaje;\r\n    alerta.classList.add('alerta');\r\n    alerta.classList.add(tipo);\r\n    \r\n    const referencia = document.querySelector(elemento);\r\n    referencia.appendChild(alerta);\r\n\r\n    if(desaparece){\r\n        setTimeout(()=>{\r\n            alerta.remove();\r\n        },3000);\r\n    }\r\n}\r\n\r\n\r\nfunction mostrarResumen(){\r\n\r\n    //verificar si hay datos faltantes\r\n    if(Object.values(cita).includes(\"\") || cita.servicios.length == 0){\r\n\r\n        if(Object.values(cita).includes(\"\")){\r\n            mostrarAlerta('Falta el horario de la cita','error','.contenido-resumen',false);\r\n        }\r\n\r\n        if(cita.servicios.length == 0){\r\n            mostrarAlerta('Falta seleccionar al menos un servicio','error','.contenido-resumen',false);\r\n        } \r\n\r\n    }else{\r\n\r\n        //mostrar resumen\r\n\r\n        const resumen = document.querySelector('.contenido-resumen');\r\n        const citaPrevia = document.querySelector('.cita-container');\r\n\r\n        if(citaPrevia){\r\n            citaPrevia.remove();\r\n        }\r\n\r\n        const citaContainer = document.createElement('DIV');\r\n        citaContainer.classList.add('cita-container');\r\n        resumen.appendChild(citaContainer);\r\n\r\n\r\n        //titulo para la cita\r\n        const tituloCita = document.createElement('P');\r\n        tituloCita.innerHTML ='<p class=\"text-center bold\">Datos de la cita</P>';\r\n        citaContainer.appendChild(tituloCita);\r\n\r\n        const {nombre, fecha,hora, servicios} = cita;\r\n\r\n        const nombreCliente = document.createElement('P');\r\n        nombreCliente.innerHTML = `<span class=\"resaltado\">Nombre:  </span>${nombre}`;\r\n        citaContainer.appendChild(nombreCliente);\r\n\r\n\r\n        // Formatear la fecha en espa√±ol\r\n        const fechaObj = new Date(fecha);\r\n        const mes = fechaObj.getMonth();\r\n        const dia = fechaObj.getDate() + 2;\r\n        const year = fechaObj.getFullYear();\r\n\r\n        const fechaUTC = new Date( Date.UTC(year, mes, dia));\r\n        \r\n        const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'}\r\n        const fechaFormateada = fechaUTC.toLocaleDateString('es-MX', opciones);\r\n\r\n        const fechaCita = document.createElement('P');\r\n        fechaCita.innerHTML = `<span class=\"resaltado\">Fecha:  </span>${fechaFormateada}`;\r\n        citaContainer.appendChild(fechaCita);\r\n\r\n        const horaCita = document.createElement('P');\r\n        horaCita.innerHTML = `<span class=\"resaltado\">Hora:  </span>${hora} horas`;\r\n        citaContainer.appendChild(horaCita);\r\n\r\n        //titulo para los servicios\r\n        const tituloServicios = document.createElement('P');\r\n        tituloServicios.innerHTML ='<p class=\"text-center bold\">Servicios seleccionados</P>';\r\n        citaContainer.appendChild(tituloServicios);\r\n\r\n        let total = 0;\r\n\r\n        servicios.forEach(function(servicio){\r\n            const {nombre,precio} = servicio;\r\n            \r\n            const nombreServicio = document.createElement('P');\r\n            nombreServicio.classList.add('nombre-servicio');\r\n            nombreServicio.textContent = nombre;\r\n    \r\n            const precioServicio = document.createElement('P');\r\n            precioServicio.classList.add('precio-servicio');\r\n            precioServicio.textContent =`$${precio}`;\r\n            total = total + parseInt(precio);\r\n\r\n            const servicioDiv = document.createElement('DIV');\r\n            servicioDiv.classList.add('servicio');\r\n            servicioDiv.classList.add('resumen');\r\n            \r\n    \r\n            servicioDiv.appendChild(nombreServicio);\r\n            servicioDiv.appendChild(precioServicio);\r\n            citaContainer.appendChild(servicioDiv);\r\n        });\r\n\r\n        const precioTotal = document.createElement('P');\r\n        precioTotal.innerHTML = `<p class=\"monto-total\">Monto total: <span class=\"precio-servicio\">$${total}</span></p>`;\r\n        citaContainer.appendChild(precioTotal);\r\n\r\n        const botonReservar = document.createElement('BUTTON');\r\n        botonReservar.classList.add('boton');\r\n        botonReservar.textContent = 'Reservar cita';\r\n        citaContainer.appendChild(botonReservar);\r\n\r\n        botonReservar.onclick = reservaCita;\r\n    }\r\n}\r\n\r\nasync function reservaCita(){\r\n\r\n    const {nombre,fecha,hora,servicios,id} = cita;\r\n    const idServicios = servicios.map( servicio => servicio.id );\r\n\r\n    const datos = new FormData();\r\n    datos.append('fecha',fecha);\r\n    datos.append('hora',hora);\r\n    datos.append('servicios',idServicios);\r\n    datos.append('usuarioId',id);\r\n    \r\n    try {\r\n        const url = 'http://localhost:3000/api/citas';\r\n        const respuesta = await fetch(url, {\r\n            method: 'POST',\r\n            body: datos\r\n        });\r\n\r\n        const resultado = await respuesta.json();\r\n        console.log(resultado);\r\n        \r\n        if(resultado.resultado){\r\n            Swal.fire(\r\n                'Tu cita fue reservada con exito!',\r\n                'Te esperamos pronto',\r\n                'success'\r\n            ).then( ()=>{\r\n                window.location.reload();\r\n            })\r\n        }\r\n    } catch (error) {\r\n\r\n        Swal.fire(\r\n            'Ocurrio un error en la reserva de la cita',\r\n            'Intenta mas tarde',\r\n            'error'\r\n        ).then( ()=>{\r\n            window.location.reload();\r\n        })\r\n    }\r\n\r\n    //console.log([...datos]);\r\n}\r\n\r\n\r\n\r\n"],"file":"app.js"}